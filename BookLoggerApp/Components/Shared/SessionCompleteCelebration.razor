@using BookLoggerApp.Core.Models

@if (Result != null)
{
    <div class="celebration-overlay" @onclick="HandleClose">
        <div class="celebration-card" @onclick:stopPropagation="true">
            <!-- Confetti particles -->
            @for (int i = 0; i < 9; i++)
            {
                <div class="confetti"></div>
            }

            <!-- Header -->
            <div class="session-complete-header">
                <h1>ðŸŽ‰ Session Complete!</h1>
            </div>

            <!-- XP Breakdown -->
            <div class="xp-breakdown">
                
                @if (Result.PagesXp > 0)
                {
                    <div class="xp-row">
                        <span class="xp-label">Pages Read</span>
                        <span class="xp-value">+@Result.PagesXp XP</span>
                    </div>
                }

                @if (Result.MinutesXp > 0)
                {
                    <div class="xp-row">
                        <span class="xp-label">Reading Time</span>
                        <span class="xp-value">+@Result.MinutesXp XP</span>
                    </div>
                }

                @if (Result.LongSessionBonusXp > 0)
                {
                    <div class="xp-row">
                        <span class="xp-label">Long Session Bonus</span>
                        <span class="xp-value">+@Result.LongSessionBonusXp XP</span>
                    </div>
                }

                @if (Result.BookCompletionXp > 0)
                {
                    <div class="xp-row">
                        <span class="xp-label">Book Completed</span>
                        <span class="xp-value">+@Result.BookCompletionXp XP</span>
                    </div>
                }

                @if (Result.StreakBonusXp > 0)
                {
                    <div class="xp-row">
                        <span class="xp-label">Streak Bonus</span>
                        <span class="xp-value">+@Result.StreakBonusXp XP</span>
                    </div>
                }

                <div class="xp-divider"></div>

                <div class="xp-row subtotal">
                    <span class="xp-label">Subtotal</span>
                    <span class="xp-value">@Result.BaseXp XP</span>
                </div>

                @if (Result.PlantBoostPercentage > 0)
                {
                    <div class="xp-row">
                        <span class="xp-label">ðŸŒ± Plant Boost (@(Math.Round(Result.PlantBoostPercentage * 100))%)</span>
                        <span class="xp-value">+@Result.BoostedXp XP</span>
                    </div>
                }

                <div class="xp-divider"></div>

                <div class="xp-row total-row">
                    <span class="xp-label">Total XP Gained</span>
                    <span class="xp-value total">@Result.XpEarned XP</span>
                </div>
            </div>

            <!-- Progress bar (optional) -->


            <!-- Continue Button -->
            <button class="celebration-button" @onclick="HandleClose">
                Continue
            </button>
        </div>
    </div>
}

@code {
    [Parameter] public ProgressionResult? Result { get; set; }
    [Parameter] public EventCallback OnClose { get; set; }
    [Parameter] public bool ShowProgressBar { get; set; } = true;
    [Parameter] public decimal ProgressPercentage { get; set; } = 0;

    private async Task HandleClose()
    {
        await OnClose.InvokeAsync();
    }
}
