## 2025-05-24 - Unrestricted File Download / DoS in ImageService
**Vulnerability:** The `ImageService.DownloadImageFromUrlAsync` method was vulnerable to Denial of Service (DoS) and potential SSRF (albeit limited in client context) because it blindly downloaded content from any URL without validating the file size or content type.
**Learning:** `HttpClient` download methods (like `GetAsync` or `GetByteArrayAsync`) buffer the response by default. To safely handle potentially malicious large files, one must use `HttpCompletionOption.ResponseHeadersRead` and enforce limits while streaming. Also, validating `Content-Type` early prevents processing non-image types.
**Prevention:** Always validate `Content-Length`, `Content-Type`, and enforce a hard limit on the bytes read from the stream when dealing with untrusted URLs. Use `HttpCompletionOption.ResponseHeadersRead` to inspect headers before committing to download the body.
